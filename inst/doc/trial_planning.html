<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="James Bell" />

<meta name="date" content="2019-04-25" />

<title>Planning Time-To-Event Trials with gestate</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Planning Time-To-Event Trials with gestate</h1>
<h4 class="author">James Bell</h4>
<h4 class="date">2019-04-25</h4>



<div id="introduction" class="section level2">
<h2>1 Introduction</h2>
<div id="vignette-overview" class="section level3">
<h3>1.1 Vignette Overview</h3>
<p>The gestate package is designed to assist accurate planning and event prediction for time-to-event clinical trials. In this vignette, we introduce the gestate package, and demonstrate how it may be used in trial planning. A separate vignette covers event prediction of ongoing trials. The first section will show how distributions are easily described and stored as Curve and RCurve objects. The second section will demonstrate analytic methods for trial planning, and the third section will show how simulate may be alternatively used.</p>
</div>
<div id="exponential-distributions" class="section level3">
<h3>1.2 Exponential Distributions</h3>
<p>The least possible information required to calculate a time-to-event trial’s predicted properties are distributions of events in each arm and an expected distribution of patient recruitment, including the numbers in each arm. However typically event distributions are over-simplified by implicitly assuming exponential distributions and then defining them by a single number (often the median). This shortcut is not available in gestate Since events in many clinical trials do not follow exponential distributions and assuming this without evidence can lead to wildly inaccurate trial planning. Even where no historical information is available and an exponential distribution can be considered to be the best guess, it is important to be clear that there is an assumption being made that the distribution is exponential. Gestate therefore requires explicit selection of distribution types, as well as their parameters, and does not default to exponential.</p>
</div>
<div id="non-proportional-hazards-and-complex-censoring" class="section level3">
<h3>1.3 Non-Proportional Hazards and Complex Censoring</h3>
<p>Aside from simplicity, one of the historical reasons for use of the exponential distribution was a requirement for proportional hazards in many analysis methods, although this should not have prevented use of Weibull distributions. With the rising importance of non-proportional hazards in clinical trials, it is important that trial planning methods can handle both the expected patterns of events and also analytical approaches that are more suited to this situation. To date, this has mainly been done by simulation, with the standard drawbacks of having to account for Monte Carlo error and being relatively slow. Gestate’s numerical integration methods and Curve architecture for handling distributions are designed to handle unusual event distributions as well as complex censoring patterns, and to produce calculations for a range of analytical methods. These approaches are extremely fast in comparison to simulation, and generally quite accurate. Simulation tools have also been provided to assist in validating output, but it is intended that the user arrives at their preferred sample size and then validates it by simulation - this workflow is designed to produce a considerable time-saving.</p>
</div>
<div id="power-calculation-vs-sample-size-calculation" class="section level3">
<h3>1.4 Power Calculation vs Sample Size Calculation</h3>
<p>The gestate package is designed around power calculation rather than sample size calculation. While the reasoning behind this is obvious in the case of the simulation aspect, here is a brief explanation for this with the analytic approach.</p>
<p>First, it should be noted that changing the sample size more than trivially without changing the length or shape of recruitment is logistically difficult. The length and shape of recruitment are also important for calculating the number of events at any given time. So any ‘sample size optimisation’ approach must either make the probably unrealistic assumption that the rate of recruitment can be scaled freely, or it must have an algorithm for changing other recruitment parameters. As trial logistics vary widely, it is unlikely that a sensible general-purpose algorithm would be possible, and even if it were, it would complicate optimisation of sample size. Therefore, although gestate does provide an option to estimate a sample size that would produce a given power at each time point, it does so based on the unrealistic free recruitment-rate scaling assumption, and it is best used as an indication of the scenario to next calculate power for.</p>
<p>A further complicating factor for direct sample size calculation is that the correspondance between event numbers and power is not absolute, even for log-rank tests. Particularly when randomisation ratios are not 1:1, it can be shown that the ‘maturity’ of the data (and in particular the ratio of events between arms) affects the number of events required for a given power. This is highlighted by the inclusion of the Frontier Power method for power calculation that is included in the package and which is a generalisation of the Schoenfeld formula to handle unequal randomisation ratios appropriately. Since data maturity affects power, simply scaling the sample size to achieve the desired number of events may not give you the required power<sup>1</sup>.</p>
</div>
<div id="shiny-app" class="section level3">
<h3>1.5 Shiny App</h3>
<p>The gestate package contains a built-in Shiny App to implement most of the functionality covered in this vignette.</p>
<p>It may be run by the command ‘run_gestate()’.</p>
<p>The app contains real-time interactive plots for the currently specified Curves and RCurve. Updating them will also update the plots. This can be useful for checking parameterisation. Most functionality is covered, and both analytic and simulation approaches are included. Most parameters and arguments are shared between the two approaches, so once one is run, it is trivial to also run the other. All plots and tables created are downloadable.</p>
<p>In general, it is recommended to use the app for interactive, low-throughput sessions, perhaps when there is uncertainty about parameters. It also makes a good starting point for new users of gestate. Use of gestate directly in R is recommended for higher throughput workflows, systematic searching of parameters, or where outputs are fed into other programs.</p>
</div>
</div>
<div id="curves" class="section level2">
<h2>2 Curves</h2>
<div id="event-and-censoring-distribution-description-and-storage-curve-objects" class="section level3">
<h3>2.1 Event and Censoring Distribution Description and Storage: Curve Objects</h3>
<p>The gestate package is built upon Curve objects, named because they describe a Survival curve. These contain all necessary information about probability distributions that may be useful for planning time-to-event trials, including both the parameters and the names of functions governing its behaviour.</p>
<p>Curve objects serve three main purposes; they allow the gestate code to be independent of the distributions it runs, allow the free interchange and combination of different distributions, and provide a convenient format for holding all relevant information about a distribution.</p>
<p>So long as a distribution is supported, a user may create a Curve object by using a (constructor) function corresponding to the distribution of interest, providing its parameters as arguments.</p>
<p>gestate V1.3.x comes with the following distributions supported as Curve objects:</p>
<table>
<colgroup>
<col width="25%"></col>
<col width="23%"></col>
<col width="38%"></col>
<col width="12%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">Distribution</th>
<th align="left">Function</th>
<th align="left">Parameter Arguments</th>
<th align="left">S(t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Exponential</td>
<td align="left">Exponential</td>
<td align="left">lambda</td>
<td align="left"><span class="math inline">\(e^{- \lambda t}\)</span></td>
</tr>
<tr class="even">
<td align="left">Weibull</td>
<td align="left">Weibull</td>
<td align="left">alpha, beta</td>
<td align="left"><span class="math inline">\(e^{-(t/\alpha)^\beta)}\)</span></td>
</tr>
<tr class="odd">
<td align="left">Log-Normal</td>
<td align="left">Lognormal</td>
<td align="left">mu, sigma</td>
<td align="left"><span class="math inline">\(0.5(1+erf\left(\frac{\log(t)-\mu }{\sigma\sqrt2}\right))\)</span></td>
</tr>
<tr class="even">
<td align="left">Log-Logistic</td>
<td align="left">LogLogistic</td>
<td align="left">theta, eta</td>
<td align="left"><span class="math inline">\(\frac{t^{\eta}}{\theta^{\eta}+t^{\eta}}\)</span></td>
</tr>
<tr class="odd">
<td align="left">Gompertz</td>
<td align="left">Gompertz</td>
<td align="left">theta, eta</td>
<td align="left"><span class="math inline">\(e^{\eta - \eta e^{\theta t}}\)</span></td>
</tr>
<tr class="even">
<td align="left">Generalised Gamma</td>
<td align="left">GGamma</td>
<td align="left">theta, eta, rho</td>
<td align="left"><span class="math inline">\(\frac{\Gamma(\eta,(t/\theta)^\rho)}{\Gamma(\eta)}\)</span></td>
</tr>
<tr class="odd">
<td align="left">Piecewise-Exponential</td>
<td align="left">PieceExponential</td>
<td align="left">start, lambda</td>
<td align="left"><span class="math inline">\(\prod_{x = 1}^{len(\mathbf{\lambda})} e^{- \lambda_x t_x}\)</span> where <span class="math inline">\(t_x = \min{(start_{x+1},(\max{(0,t-start_x)}))}\)</span> <span class="math inline">\(start_{x+1} = Inf\)</span> if otherwise undefined.</td>
</tr>
<tr class="even">
<td align="left">Mixture-Exponential</td>
<td align="left">MixExp</td>
<td align="left">props, lambdas</td>
<td align="left"><span class="math inline">\(p_{1}e^{- \lambda_{1} t} + p_{2}e^{- \lambda_{2} t} + ...\)</span></td>
</tr>
<tr class="odd">
<td align="left">Mixture-Weibull</td>
<td align="left">MixWei</td>
<td align="left">props, alphas, betas</td>
<td align="left"><span class="math inline">\(p_{1}e^{-(t/\alpha_{1})^{\beta_{1})}} + p_{1}e^{-(t/\alpha_{2})^{\beta_{2})}}+...\)</span></td>
</tr>
<tr class="even">
<td align="left">Null</td>
<td align="left">Blank</td>
<td align="left"></td>
<td align="left"><span class="math inline">\(1\)</span></td>
</tr>
</tbody>
</table>
<p>Event distributions and dropout-censoring distributions must be provided to gestate in Curve format. An example of defining a Curve is as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(gestate)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co"># Define a Weibull curve with shape 0.8 and scale 200:</span></a>
<a class="sourceLine" id="cb1-3" title="3">curve1 &lt;-<span class="st"> </span><span class="kw">Weibull</span>(<span class="dt">alpha=</span><span class="dv">200</span>,<span class="dt">beta=</span><span class="fl">0.8</span>)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co"># Show the specified curve</span></a>
<a class="sourceLine" id="cb1-5" title="5">curve1</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; Type: Weibull </span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt;    scale :  200 </span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt;    shape :  0.8</span></a></code></pre></div>
<p>Where you want to make an event / censoring impossible, you can use define a null Curve by the function Blank(). Typically, this is the starting point for calculations (the ‘practical default’), and is useful where no dropout censoring is required. The null curve is also the default within gestate for the dropout censoring distribution.</p>
</div>
<div id="recruitment-distribution-description-and-storage-rcurve" class="section level3">
<h3>2.2 Recruitment distribution description and storage: RCurve</h3>
<p>Recruitment-associated distributions use a special form of Curve object; the RCurve. This differs in several ways. Firstly, it also includes details of patient numbers for two arms; an active arm and a control arm. Secondly, it stores the distribution of patient recruitment, rather than a censoring distribution. This is because the ‘censoring distribution’ can only be defined in conjunction with an assessment time.</p>
<p>gestate V1.3.x comes with the following recruitment distributions supported as RCurve objects:</p>
<table>
<colgroup>
<col width="20%"></col>
<col width="14%"></col>
<col width="30%"></col>
<col width="33%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">Distribution</th>
<th align="left">Function</th>
<th align="left">Parameter Arguments</th>
<th align="left">Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Linear</td>
<td align="left">LinearR</td>
<td align="left">rlength, Nactive, Ncontrol</td>
<td align="left">Standard linear recruitment</td>
</tr>
<tr class="even">
<td align="left">Instant</td>
<td align="left">InstantR</td>
<td align="left">Nactive, Ncontrol</td>
<td align="left">All patients in trial for same duration</td>
</tr>
<tr class="odd">
<td align="left">Piecewise-linear</td>
<td align="left">PieceR</td>
<td align="left">recruitment, ratio</td>
<td align="left">Recruitment is two-column matrix of durations and rates</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Define a linear recruitment over 12 months with 100 patients in each arm:</span></a>
<a class="sourceLine" id="cb2-2" title="2">rcurve1 &lt;-<span class="st"> </span><span class="kw">LinearR</span>(<span class="dt">rlength=</span><span class="dv">12</span>,<span class="dt">Nactive=</span><span class="dv">100</span>,<span class="dt">Ncontrol=</span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">rcurve1</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&gt; RCurve Object</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">#&gt; Type: LinearR </span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">#&gt; N Total: 200 </span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&gt; N Active: 100 </span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#&gt; N Control: 100 </span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">#&gt; Recruitment Ratio: 1 </span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">#&gt;    rlength :  12</span></a>
<a class="sourceLine" id="cb2-12" title="12"></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co"># Define a more complex recruitment with increasing rates</span></a>
<a class="sourceLine" id="cb2-14" title="14">pieces &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="fl">32.5</span>),<span class="dt">ncol=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-15" title="15"><span class="co">#Matrix to create a piecewise recruitment distribution. First column should be duration, second column should be rate.</span></a>
<a class="sourceLine" id="cb2-16" title="16">pieces</a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co">#&gt;      [,1] [,2]</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="co">#&gt; [1,]    1  5.0</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="co">#&gt; [2,]    2 10.0</span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co">#&gt; [3,]    3 15.0</span></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="co">#&gt; [4,]    4 32.5</span></a>
<a class="sourceLine" id="cb2-22" title="22">rcurve2 &lt;-<span class="st"> </span><span class="kw">PieceR</span>(<span class="dt">recruitment=</span>pieces,<span class="dt">ratio=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-23" title="23"></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="co"># Show the specified piecewise curve</span></a>
<a class="sourceLine" id="cb2-25" title="25">rcurve2</a>
<a class="sourceLine" id="cb2-26" title="26"><span class="co">#&gt; RCurve Object</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="co">#&gt; Type: PieceR </span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="co">#&gt; N Total: 200 </span></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="co">#&gt; N Active: 100 </span></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="co">#&gt; N Control: 100 </span></a>
<a class="sourceLine" id="cb2-31" title="31"><span class="co">#&gt; Recruitment Ratio: 1 </span></a>
<a class="sourceLine" id="cb2-32" title="32"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb2-33" title="33"><span class="co">#&gt;    lengths :  1 2 3 4 </span></a>
<a class="sourceLine" id="cb2-34" title="34"><span class="co">#&gt;    rates :  5 10 15 32.5</span></a></code></pre></div>
</div>
</div>
<div id="analytic-planning-of-time-to-event-trials-nph_traj" class="section level2">
<h2>3 Analytic Planning of Time-to-Event Trials: nph_traj</h2>
<p>Common questions in planning time to event trials include what the expected number of events, survival function, power or width of HR confidence interval will be at any given time. In non-proportion hazards situations, the expected hazard ratio or difference in RMST at a given time (including power to test them) may also be of interest. nph_traj is designed to analytically answer these questions and to do so in real-time.</p>
<p>nph_traj uses numerical integration techniques to calculate expected event numbers in each arm at each time point and from these derives predicted properties for the log-rank test and Cox regression using an approach based upon the Pike approximation for the HR<sup>2</sup>. Separate numerical integration approaches are also used to predict standard errors for RMST and landmark analysis in the presence of censoring and hence calculate power for these analyses.</p>
<p>Due to the interchangeability of Curve objects and the flexibility afforded by numerical integration, the nph_traj function can therefore be used to analytically calculate expected properties over time of a time-to-event trial, even under non-proportional hazards or with complex censoring distributions and hence also derive power trajectories for multiple common analysis methods.</p>
<p>nph_traj makes no explicit assumptions about the unit of time, only that all inputs have the same unit. In practice however, it is usually most convenient for clinical trial planning to use units of months. nph_traj creates trajectories with one entry at each integer time, so using units of years will typically lead to overly-granular trajectories. Conversely, using e.g. units of days or weeks is typically impractical (as recruitment data is typically summarised by month), slow (due to the increased number of calculations), and over-precise (time lags and uncertainties typically ensure that timings to the nearest month are of most relevance).</p>
<div id="getting-started-simple-log-rank-and-hazard-ratio-calculations" class="section level3">
<h3>3.1 Getting started: Simple Log-Rank and Hazard-Ratio Calculations</h3>
<p>At a minimum, nph_traj requires a Curve object to describe the distribution of each of the active and control arms (‘active_ecurve’ and ‘control_ecurve’ arguments respectively), as well as an RCurve object (‘rcurve’ argument) to describe the recruitment distribution. For more information on Curve and RCurve objects, see section 2. The distributions of the active and control arms should typically be estimated based upon parameters or curve-fitting from previous trials (using e.g. fit_KM or fit_KM_tte_data from the gestate package; see the event_prediction vignette).</p>
<p>Example call:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># Define exponential distributions for active and control arms, with HR of 0.7</span></a>
<a class="sourceLine" id="cb3-2" title="2">controlCurve &lt;-<span class="st"> </span><span class="kw">Exponential</span>(<span class="dt">lambda=</span><span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb3-3" title="3">activeCurve &lt;-<span class="st"> </span><span class="kw">Exponential</span>(<span class="dt">lambda=</span><span class="fl">0.1</span><span class="op">*</span><span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co"># Define a linear recruitment of 400 patients</span></a>
<a class="sourceLine" id="cb3-6" title="6">rcurve3 &lt;-<span class="st"> </span><span class="kw">LinearR</span>(<span class="dt">rlength=</span><span class="dv">12</span>,<span class="dt">Nactive=</span><span class="dv">200</span>,<span class="dt">Ncontrol=</span><span class="dv">200</span>)</a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="co"># Run nph_traj with default settings to calculate expected properties up to 10 months</span></a>
<a class="sourceLine" id="cb3-9" title="9">output &lt;-<span class="st"> </span><span class="kw">nph_traj</span>(<span class="dt">active_ecurve=</span>activeCurve,<span class="dt">control_ecurve=</span>controlCurve,<span class="dt">rcurve=</span>rcurve3,<span class="dt">max_assessment=</span><span class="dv">10</span>)</a></code></pre></div>
</div>
<div id="interpreting-output" class="section level3">
<h3>3.2 Interpreting Output</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Show output from previous section</span></a>
<a class="sourceLine" id="cb4-2" title="2">output</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt; $active_ecurve</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt; Type: Exponential </span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt;    rate :  0.07 </span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt; $control_ecurve</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt; Type: Exponential </span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt;    rate :  0.1 </span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt; $active_dcurve</span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">#&gt; Type: Blank </span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="co">#&gt;    Zero :  0 </span></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co">#&gt; $control_dcurve</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="co">#&gt; Type: Blank </span></a>
<a class="sourceLine" id="cb4-24" title="24"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb4-25" title="25"><span class="co">#&gt;    Zero :  0 </span></a>
<a class="sourceLine" id="cb4-26" title="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-27" title="27"><span class="co">#&gt; $rcurve</span></a>
<a class="sourceLine" id="cb4-28" title="28"><span class="co">#&gt; RCurve Object</span></a>
<a class="sourceLine" id="cb4-29" title="29"><span class="co">#&gt; Type: LinearR </span></a>
<a class="sourceLine" id="cb4-30" title="30"><span class="co">#&gt; N Total: 400 </span></a>
<a class="sourceLine" id="cb4-31" title="31"><span class="co">#&gt; N Active: 200 </span></a>
<a class="sourceLine" id="cb4-32" title="32"><span class="co">#&gt; N Control: 200 </span></a>
<a class="sourceLine" id="cb4-33" title="33"><span class="co">#&gt; Recruitment Ratio: 1 </span></a>
<a class="sourceLine" id="cb4-34" title="34"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb4-35" title="35"><span class="co">#&gt;    rlength :  12 </span></a>
<a class="sourceLine" id="cb4-36" title="36"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-37" title="37"><span class="co">#&gt; $Summary</span></a>
<a class="sourceLine" id="cb4-38" title="38"><span class="co">#&gt;    Time Patients Events_Active Events_Control Events_Total  HR   LogHR</span></a>
<a class="sourceLine" id="cb4-39" title="39"><span class="co">#&gt; 1     1    33.33         0.570          0.806        1.376 0.7 -0.3567</span></a>
<a class="sourceLine" id="cb4-40" title="40"><span class="co">#&gt; 2     2    66.67         2.228          3.122        5.350 0.7 -0.3567</span></a>
<a class="sourceLine" id="cb4-41" title="41"><span class="co">#&gt; 3     3   100.00         4.901          6.803       11.704 0.7 -0.3567</span></a>
<a class="sourceLine" id="cb4-42" title="42"><span class="co">#&gt; 4     4   133.33         8.520         11.720       20.240 0.7 -0.3567</span></a>
<a class="sourceLine" id="cb4-43" title="43"><span class="co">#&gt; 5     5   166.67        13.021         17.755       30.776 0.7 -0.3567</span></a>
<a class="sourceLine" id="cb4-44" title="44"><span class="co">#&gt; 6     6   200.00        18.344         24.802       43.146 0.7 -0.3567</span></a>
<a class="sourceLine" id="cb4-45" title="45"><span class="co">#&gt; 7     7   233.33        24.435         32.764       57.199 0.7 -0.3567</span></a>
<a class="sourceLine" id="cb4-46" title="46"><span class="co">#&gt; 8     8   266.67        31.240         41.555       72.795 0.7 -0.3567</span></a>
<a class="sourceLine" id="cb4-47" title="47"><span class="co">#&gt; 9     9   300.00        38.712         51.095       89.807 0.7 -0.3567</span></a>
<a class="sourceLine" id="cb4-48" title="48"><span class="co">#&gt; 10   10   333.33        46.806         61.313      108.119 0.7 -0.3567</span></a>
<a class="sourceLine" id="cb4-49" title="49"><span class="co">#&gt;    LogHR_SE Schoenfeld_Power Frontier_Power</span></a>
<a class="sourceLine" id="cb4-50" title="50"><span class="co">#&gt; 1   1.72143           0.0400         0.0323</span></a>
<a class="sourceLine" id="cb4-51" title="51"><span class="co">#&gt; 2   0.87239           0.0609         0.0434</span></a>
<a class="sourceLine" id="cb4-52" title="52"><span class="co">#&gt; 3   0.58938           0.0885         0.0555</span></a>
<a class="sourceLine" id="cb4-53" title="53"><span class="co">#&gt; 4   0.44788           0.1235         0.1085</span></a>
<a class="sourceLine" id="cb4-54" title="54"><span class="co">#&gt; 5   0.36298           0.1659         0.1531</span></a>
<a class="sourceLine" id="cb4-55" title="55"><span class="co">#&gt; 6   0.30639           0.2152         0.2037</span></a>
<a class="sourceLine" id="cb4-56" title="56"><span class="co">#&gt; 7   0.26596           0.2705         0.2600</span></a>
<a class="sourceLine" id="cb4-57" title="57"><span class="co">#&gt; 8   0.23564           0.3306         0.3210</span></a>
<a class="sourceLine" id="cb4-58" title="58"><span class="co">#&gt; 9   0.21205           0.3936         0.3850</span></a>
<a class="sourceLine" id="cb4-59" title="59"><span class="co">#&gt; 10  0.19318           0.4579         0.4504</span></a></code></pre></div>
<p>The output from nph_traj is a list, with the first few entries corresponding to the input Curve and RCurve objects to provide context to the results. The results themselves are found under $Summary and are in the form of a trajectory, providing information about the trial at each integer time point up to the maximum assessment time (‘max_assessment’ argument).</p>
<p>Each row corresponds to a separate time point, given by the first column;‘Time’. The second column, ‘Patients’ gives the expected number of patients entered into the trial by that time. The three ‘Events’ columns give the expected numbers of events in each arm and overall at each time.The next three columns provide the Hazard Ratio, Log-Hazard Ratio and SE of the Log-Hazard Ratio. Finally, the power for the log-rank test / Cox regression are given based upon the Schoenfeld<sup>3,4</sup> and Frontier<sup>1</sup> methods.</p>
</div>
<div id="censoring" class="section level3">
<h3>3.3 Censoring</h3>
<p>Administrative censoring is handled implicitly based upon the specified RCurve object. However, dropout censoring is also common in time-to-event trials. This can be specified through Curve objects, and separate censoring distributions are supported for each arm. By default, gestate uses no censoring via the Blank() Curve.</p>
<p>It should be noted that the required censoring distributions must represent that of the censoring that would occur in the absence of events or administrative censoring. The observed numbers of censored patients in each arm will therefore also depend partially on the event distributions. The suggested way to use existing data to parameterise the censoring distributions is to create ‘reverse Kaplan Meier’ plots of existing data, whereby dropout censorings are ‘events’, and both events and administrative censorings are ‘censorings’. Curve-fitting techniques (e.g. fit_KM or fit_KM_tte_data from gestate, see event_prediction vignette) may then be used to estimate the parametric distributions.</p>
</div>
<div id="otheradvanced-options" class="section level3">
<h3>3.4 Other/Advanced Options</h3>
<p>To control the one-sided type I error for power calculations, the ‘alpha1’ argument may be used. This is 0.025 by default.</p>
<p>An additional feature of nph_traj is it can estimate the required number of patients to achieve a given power at a given time point (using Schoenfeld), assuming all parameters remain constant (only the rate of recruitment changes to allow patient number to change in the existing specified time frame). This can be requested by setting the ‘required_power’ argument to the required decimal, e.g. 0.9 for 90% power. For sample size calculations it is strongly recommended to only use this as a guide of the next set of parameters to try, and to rerun the calculation. This is because unless the number is similar to that in the existing RCurve, it will typically require changing the recruitment length to reach the new number, and that will result in changes to the calculation.</p>
<p>It is also possible to get more detailed outputs by specifying ‘detailed_output=TRUE’. This includes several additional quantities required by the calculations or derived from them. Full details may be found in the documentation of the nph_traj function (via e.g. ?nph_traj).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># Define exponential distributions for active and control arms, with HR of 0.7</span></a>
<a class="sourceLine" id="cb5-2" title="2">censorCurveA &lt;-<span class="st"> </span><span class="kw">Exponential</span>(<span class="dt">lambda=</span><span class="fl">0.001</span>)</a>
<a class="sourceLine" id="cb5-3" title="3">censorCurveC &lt;-<span class="st"> </span><span class="kw">Exponential</span>(<span class="dt">lambda=</span><span class="fl">0.002</span>)</a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co"># Run nph_traj with default settings to calculate expected properties up to 10 months</span></a>
<a class="sourceLine" id="cb5-6" title="6">output1 &lt;-<span class="st"> </span><span class="kw">nph_traj</span>(<span class="dt">active_ecurve=</span>activeCurve,<span class="dt">control_ecurve=</span>controlCurve,<span class="dt">active_dcurve=</span>censorCurveA,<span class="dt">control_dcurve=</span>censorCurveC,<span class="dt">rcurve=</span>rcurve3,<span class="dt">max_assessment=</span><span class="dv">10</span>,<span class="dt">detailed_output =</span> <span class="ot">TRUE</span>,<span class="dt">required_power =</span> <span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co"># Display output</span></a>
<a class="sourceLine" id="cb5-8" title="8">output1</a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">#&gt; $active_ecurve</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&gt; Type: Exponential </span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">#&gt;    rate :  0.07 </span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt; $control_ecurve</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">#&gt; Type: Exponential </span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="co">#&gt;    rate :  0.1 </span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">#&gt; $active_dcurve</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="co">#&gt; Type: Exponential </span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb5-25" title="25"><span class="co">#&gt;    rate :  0.001 </span></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-27" title="27"><span class="co">#&gt; $control_dcurve</span></a>
<a class="sourceLine" id="cb5-28" title="28"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb5-29" title="29"><span class="co">#&gt; Type: Exponential </span></a>
<a class="sourceLine" id="cb5-30" title="30"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb5-31" title="31"><span class="co">#&gt;    rate :  0.002 </span></a>
<a class="sourceLine" id="cb5-32" title="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-33" title="33"><span class="co">#&gt; $rcurve</span></a>
<a class="sourceLine" id="cb5-34" title="34"><span class="co">#&gt; RCurve Object</span></a>
<a class="sourceLine" id="cb5-35" title="35"><span class="co">#&gt; Type: LinearR </span></a>
<a class="sourceLine" id="cb5-36" title="36"><span class="co">#&gt; N Total: 400 </span></a>
<a class="sourceLine" id="cb5-37" title="37"><span class="co">#&gt; N Active: 200 </span></a>
<a class="sourceLine" id="cb5-38" title="38"><span class="co">#&gt; N Control: 200 </span></a>
<a class="sourceLine" id="cb5-39" title="39"><span class="co">#&gt; Recruitment Ratio: 1 </span></a>
<a class="sourceLine" id="cb5-40" title="40"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb5-41" title="41"><span class="co">#&gt;    rlength :  12 </span></a>
<a class="sourceLine" id="cb5-42" title="42"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-43" title="43"><span class="co">#&gt; $Summary</span></a>
<a class="sourceLine" id="cb5-44" title="44"><span class="co">#&gt;    Time Patients Events_Active Events_Control E_Events_Active</span></a>
<a class="sourceLine" id="cb5-45" title="45"><span class="co">#&gt; 1     1    33.33         0.570          0.806           0.691</span></a>
<a class="sourceLine" id="cb5-46" title="46"><span class="co">#&gt; 2     2    66.67         2.227          3.118           2.699</span></a>
<a class="sourceLine" id="cb5-47" title="47"><span class="co">#&gt; 3     3   100.00         4.896          6.790           5.930</span></a>
<a class="sourceLine" id="cb5-48" title="48"><span class="co">#&gt; 4     4   133.33         8.509         11.691          10.297</span></a>
<a class="sourceLine" id="cb5-49" title="49"><span class="co">#&gt; 5     5   166.67        13.001         17.701          15.719</span></a>
<a class="sourceLine" id="cb5-50" title="50"><span class="co">#&gt; 6     6   200.00        18.310         24.712          22.121</span></a>
<a class="sourceLine" id="cb5-51" title="51"><span class="co">#&gt; 7     7   233.33        24.382         32.629          29.434</span></a>
<a class="sourceLine" id="cb5-52" title="52"><span class="co">#&gt; 8     8   266.67        31.165         41.362          37.592</span></a>
<a class="sourceLine" id="cb5-53" title="53"><span class="co">#&gt; 9     9   300.00        38.608         50.833          46.536</span></a>
<a class="sourceLine" id="cb5-54" title="54"><span class="co">#&gt; 10   10   333.33        46.668         60.969          56.210</span></a>
<a class="sourceLine" id="cb5-55" title="55"><span class="co">#&gt;    E_Events_Control Events_Total  HR   LogHR LogHR_SE HR_CI_Upper</span></a>
<a class="sourceLine" id="cb5-56" title="56"><span class="co">#&gt; 1             0.684        1.375 0.7 -0.3567  1.72184     20.4516</span></a>
<a class="sourceLine" id="cb5-57" title="57"><span class="co">#&gt; 2             2.645        5.344 0.7 -0.3567  0.87279      3.8728</span></a>
<a class="sourceLine" id="cb5-58" title="58"><span class="co">#&gt; 3             5.757       11.686 0.7 -0.3567  0.58979      2.2239</span></a>
<a class="sourceLine" id="cb5-59" title="59"><span class="co">#&gt; 4             9.903       20.200 0.7 -0.3567  0.44829      1.6853</span></a>
<a class="sourceLine" id="cb5-60" title="60"><span class="co">#&gt; 5            14.983       30.701 0.7 -0.3567  0.36339      1.4270</span></a>
<a class="sourceLine" id="cb5-61" title="61"><span class="co">#&gt; 6            20.902       43.023 0.7 -0.3567  0.30679      1.2771</span></a>
<a class="sourceLine" id="cb5-62" title="62"><span class="co">#&gt; 7            27.578       57.011 0.7 -0.3567  0.26636      1.1798</span></a>
<a class="sourceLine" id="cb5-63" title="63"><span class="co">#&gt; 8            34.934       72.526 0.7 -0.3567  0.23604      1.1118</span></a>
<a class="sourceLine" id="cb5-64" title="64"><span class="co">#&gt; 9            42.904       89.441 0.7 -0.3567  0.21246      1.0616</span></a>
<a class="sourceLine" id="cb5-65" title="65"><span class="co">#&gt; 10           51.427      107.637 0.7 -0.3567  0.19359      1.0230</span></a>
<a class="sourceLine" id="cb5-66" title="66"><span class="co">#&gt;    HR_CI_Lower Peto_LogHR Expected_Z Expected_P Log_Rank_Stat Variance</span></a>
<a class="sourceLine" id="cb5-67" title="67"><span class="co">#&gt; 1       0.0240    -0.3533    -0.2071     0.4179       -0.1215    0.344</span></a>
<a class="sourceLine" id="cb5-68" title="68"><span class="co">#&gt; 2       0.1265    -0.3536    -0.4087     0.3414       -0.4723    1.336</span></a>
<a class="sourceLine" id="cb5-69" title="69"><span class="co">#&gt; 3       0.2203    -0.3539    -0.6048     0.2727       -1.0335    2.921</span></a>
<a class="sourceLine" id="cb5-70" title="70"><span class="co">#&gt; 4       0.2907    -0.3542    -0.7956     0.2131       -1.7875    5.047</span></a>
<a class="sourceLine" id="cb5-71" title="71"><span class="co">#&gt; 5       0.3434    -0.3544    -0.9815     0.1632       -2.7181    7.669</span></a>
<a class="sourceLine" id="cb5-72" title="72"><span class="co">#&gt; 6       0.3837    -0.3547    -1.1626     0.1225       -3.8105   10.742</span></a>
<a class="sourceLine" id="cb5-73" title="73"><span class="co">#&gt; 7       0.4153    -0.3550    -1.3391     0.0903       -5.0511   14.229</span></a>
<a class="sourceLine" id="cb5-74" title="74"><span class="co">#&gt; 8       0.4407    -0.3552    -1.5111     0.0654       -6.4275   18.093</span></a>
<a class="sourceLine" id="cb5-75" title="75"><span class="co">#&gt; 9       0.4616    -0.3555    -1.6788     0.0466       -7.9282   22.302</span></a>
<a class="sourceLine" id="cb5-76" title="76"><span class="co">#&gt; 10      0.4790    -0.3557    -1.8425     0.0327       -9.5426   26.825</span></a>
<a class="sourceLine" id="cb5-77" title="77"><span class="co">#&gt;    V_Pike_Peto Event_Ratio Schoenfeld_Power Event_Prop_Power Z_Power</span></a>
<a class="sourceLine" id="cb5-78" title="78"><span class="co">#&gt; 1        0.344      0.7072           0.0400           0.0397  0.0398</span></a>
<a class="sourceLine" id="cb5-79" title="79"><span class="co">#&gt; 2        1.336      0.7142           0.0608           0.0602  0.0604</span></a>
<a class="sourceLine" id="cb5-80" title="80"><span class="co">#&gt; 3        2.921      0.7211           0.0885           0.0872  0.0877</span></a>
<a class="sourceLine" id="cb5-81" title="81"><span class="co">#&gt; 4        5.048      0.7278           0.1233           0.1213  0.1221</span></a>
<a class="sourceLine" id="cb5-82" title="82"><span class="co">#&gt; 5        7.671      0.7345           0.1656           0.1627  0.1639</span></a>
<a class="sourceLine" id="cb5-83" title="83"><span class="co">#&gt; 6       10.747      0.7409           0.2147           0.2109  0.2126</span></a>
<a class="sourceLine" id="cb5-84" title="84"><span class="co">#&gt; 7       14.238      0.7473           0.2698           0.2651  0.2673</span></a>
<a class="sourceLine" id="cb5-85" title="85"><span class="co">#&gt; 8       18.107      0.7535           0.3295           0.3241  0.3268</span></a>
<a class="sourceLine" id="cb5-86" title="86"><span class="co">#&gt; 9       22.323      0.7595           0.3923           0.3862  0.3893</span></a>
<a class="sourceLine" id="cb5-87" title="87"><span class="co">#&gt; 10      26.856      0.7654           0.4563           0.4498  0.4532</span></a>
<a class="sourceLine" id="cb5-88" title="88"><span class="co">#&gt;    Frontier_Power Estimated_SS</span></a>
<a class="sourceLine" id="cb5-89" title="89"><span class="co">#&gt; 1          0.0323        96077</span></a>
<a class="sourceLine" id="cb5-90" title="90"><span class="co">#&gt; 2          0.0434        24727</span></a>
<a class="sourceLine" id="cb5-91" title="91"><span class="co">#&gt; 3          0.0554        11309</span></a>
<a class="sourceLine" id="cb5-92" title="92"><span class="co">#&gt; 4          0.1085         6543</span></a>
<a class="sourceLine" id="cb5-93" title="93"><span class="co">#&gt; 5          0.1529         4305</span></a>
<a class="sourceLine" id="cb5-94" title="94"><span class="co">#&gt; 6          0.2033         3072</span></a>
<a class="sourceLine" id="cb5-95" title="95"><span class="co">#&gt; 7          0.2594         2318</span></a>
<a class="sourceLine" id="cb5-96" title="96"><span class="co">#&gt; 8          0.3201         1823</span></a>
<a class="sourceLine" id="cb5-97" title="97"><span class="co">#&gt; 9          0.3839         1478</span></a>
<a class="sourceLine" id="cb5-98" title="98"><span class="co">#&gt; 10         0.4489         1228</span></a></code></pre></div>
</div>
<div id="planning-for-landmark-and-rmst-analysis" class="section level3">
<h3>3.5 Planning for Landmark and RMST Analysis</h3>
<p>nph_traj can be provided essentially any valid Curve object for each event distribution, and fully supports non-proportional hazards. To take full advantage of this, it can calculate expectations for landmark and RMST quantities, along with the estimated standard errors and power calculations.</p>
<p>To request RMST calculations, include the argument ‘RMST = x’, where x is the restriction time of interest. To request landmark calculations, include the argument ‘landmark = y’, where y is the landmark time of interest. Here is an example of a non-proportional hazards calculation where estimates of power for both RMST and landmark calculations are requested:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># Define exponential distributions for active and control arms, with HR of 0.7</span></a>
<a class="sourceLine" id="cb6-2" title="2">activeCurveNPH &lt;-<span class="st"> </span><span class="kw">Weibull</span>(<span class="dt">alpha=</span><span class="dv">100</span>,<span class="dt">beta=</span><span class="fl">0.8</span>)</a>
<a class="sourceLine" id="cb6-3" title="3">controlCurveNPH &lt;-<span class="st">  </span><span class="kw">Weibull</span>(<span class="dt">alpha=</span><span class="dv">50</span>,<span class="dt">beta=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co"># Run nph_traj with default settings to calculate expected properties up to 30 months</span></a>
<a class="sourceLine" id="cb6-6" title="6">output2 &lt;-<span class="st"> </span><span class="kw">nph_traj</span>(<span class="dt">active_ecurve=</span>activeCurveNPH,<span class="dt">control_ecurve=</span>controlCurveNPH,<span class="dt">rcurve=</span>rcurve3,<span class="dt">max_assessment=</span><span class="dv">30</span>,<span class="dt">RMST=</span><span class="dv">20</span>,<span class="dt">landmark=</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co"># Display output</span></a>
<a class="sourceLine" id="cb6-8" title="8">output2</a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt; $active_ecurve</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">#&gt; Type: Weibull </span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">#&gt;    scale :  100 </span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">#&gt;    shape :  0.8 </span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">#&gt; $control_ecurve</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">#&gt; Type: Weibull </span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="co">#&gt;    scale :  50 </span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="co">#&gt;    shape :  1 </span></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="co">#&gt; $active_dcurve</span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="co">#&gt; Type: Blank </span></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="co">#&gt;    Zero :  0 </span></a>
<a class="sourceLine" id="cb6-28" title="28"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-29" title="29"><span class="co">#&gt; $control_dcurve</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="co">#&gt; Curve Object</span></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="co">#&gt; Type: Blank </span></a>
<a class="sourceLine" id="cb6-32" title="32"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb6-33" title="33"><span class="co">#&gt;    Zero :  0 </span></a>
<a class="sourceLine" id="cb6-34" title="34"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-35" title="35"><span class="co">#&gt; $rcurve</span></a>
<a class="sourceLine" id="cb6-36" title="36"><span class="co">#&gt; RCurve Object</span></a>
<a class="sourceLine" id="cb6-37" title="37"><span class="co">#&gt; Type: LinearR </span></a>
<a class="sourceLine" id="cb6-38" title="38"><span class="co">#&gt; N Total: 400 </span></a>
<a class="sourceLine" id="cb6-39" title="39"><span class="co">#&gt; N Active: 200 </span></a>
<a class="sourceLine" id="cb6-40" title="40"><span class="co">#&gt; N Control: 200 </span></a>
<a class="sourceLine" id="cb6-41" title="41"><span class="co">#&gt; Recruitment Ratio: 1 </span></a>
<a class="sourceLine" id="cb6-42" title="42"><span class="co">#&gt; Distribution Parameters:</span></a>
<a class="sourceLine" id="cb6-43" title="43"><span class="co">#&gt;    rlength :  12 </span></a>
<a class="sourceLine" id="cb6-44" title="44"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-45" title="45"><span class="co">#&gt; $Summary</span></a>
<a class="sourceLine" id="cb6-46" title="46"><span class="co">#&gt;    Time Patients Events_Active Events_Control Events_Total     HR   LogHR</span></a>
<a class="sourceLine" id="cb6-47" title="47"><span class="co">#&gt; 1     1    33.33         0.231          0.166        0.396 1.3970  0.3343</span></a>
<a class="sourceLine" id="cb6-48" title="48"><span class="co">#&gt; 2     2    66.67         0.798          0.658        1.456 1.2173  0.1967</span></a>
<a class="sourceLine" id="cb6-49" title="49"><span class="co">#&gt; 3     3   100.00         1.646          1.470        3.116 1.1235  0.1165</span></a>
<a class="sourceLine" id="cb6-50" title="50"><span class="co">#&gt; 4     4   133.33         2.747          2.597        5.344 1.0616  0.0598</span></a>
<a class="sourceLine" id="cb6-51" title="51"><span class="co">#&gt; 5     5   166.67         4.085          4.031        8.116 1.0162  0.0160</span></a>
<a class="sourceLine" id="cb6-52" title="52"><span class="co">#&gt; 6     6   200.00         5.644          5.767       11.411 0.9806 -0.0196</span></a>
<a class="sourceLine" id="cb6-53" title="53"><span class="co">#&gt; 7     7   233.33         7.413          7.799       15.212 0.9516 -0.0496</span></a>
<a class="sourceLine" id="cb6-54" title="54"><span class="co">#&gt; 8     8   266.67         9.385         10.120       19.505 0.9273 -0.0755</span></a>
<a class="sourceLine" id="cb6-55" title="55"><span class="co">#&gt; 9     9   300.00        11.550         12.725       24.275 0.9064 -0.0983</span></a>
<a class="sourceLine" id="cb6-56" title="56"><span class="co">#&gt; 10   10   333.33        13.901         15.609       29.510 0.8882 -0.1185</span></a>
<a class="sourceLine" id="cb6-57" title="57"><span class="co">#&gt; 11   11   366.67        16.433         18.766       35.199 0.8721 -0.1368</span></a>
<a class="sourceLine" id="cb6-58" title="58"><span class="co">#&gt; 12   12   400.00        19.140         22.190       41.330 0.8577 -0.1535</span></a>
<a class="sourceLine" id="cb6-59" title="59"><span class="co">#&gt; 13   13   400.00        21.786         25.711       47.497 0.8412 -0.1729</span></a>
<a class="sourceLine" id="cb6-60" title="60"><span class="co">#&gt; 14   14   400.00        24.260         29.162       53.422 0.8243 -0.1932</span></a>
<a class="sourceLine" id="cb6-61" title="61"><span class="co">#&gt; 15   15   400.00        26.614         32.545       59.159 0.8087 -0.2124</span></a>
<a class="sourceLine" id="cb6-62" title="62"><span class="co">#&gt; 16   16   400.00        28.871         35.861       64.732 0.7943 -0.2303</span></a>
<a class="sourceLine" id="cb6-63" title="63"><span class="co">#&gt; 17   17   400.00        31.045         39.111       70.156 0.7813 -0.2468</span></a>
<a class="sourceLine" id="cb6-64" title="64"><span class="co">#&gt; 18   18   400.00        33.146         42.297       75.443 0.7694 -0.2622</span></a>
<a class="sourceLine" id="cb6-65" title="65"><span class="co">#&gt; 19   19   400.00        35.183         45.419       80.602 0.7585 -0.2764</span></a>
<a class="sourceLine" id="cb6-66" title="66"><span class="co">#&gt; 20   20   400.00        37.160         48.480       85.640 0.7485 -0.2897</span></a>
<a class="sourceLine" id="cb6-67" title="67"><span class="co">#&gt; 21   21   400.00        39.084         51.481       90.564 0.7393 -0.3021</span></a>
<a class="sourceLine" id="cb6-68" title="68"><span class="co">#&gt; 22   22   400.00        40.957         54.421       95.379 0.7308 -0.3137</span></a>
<a class="sourceLine" id="cb6-69" title="69"><span class="co">#&gt; 23   23   400.00        42.784         57.304      100.088 0.7228 -0.3246</span></a>
<a class="sourceLine" id="cb6-70" title="70"><span class="co">#&gt; 24   24   400.00        44.568         60.130      104.698 0.7154 -0.3349</span></a>
<a class="sourceLine" id="cb6-71" title="71"><span class="co">#&gt; 25   25   400.00        46.311         62.899      109.210 0.7085 -0.3446</span></a>
<a class="sourceLine" id="cb6-72" title="72"><span class="co">#&gt; 26   26   400.00        48.016         65.575      113.590 0.7020 -0.3539</span></a>
<a class="sourceLine" id="cb6-73" title="73"><span class="co">#&gt; 27   27   400.00        49.684         68.275      117.959 0.6959 -0.3625</span></a>
<a class="sourceLine" id="cb6-74" title="74"><span class="co">#&gt; 28   28   400.00        51.318         70.883      122.201 0.6902 -0.3708</span></a>
<a class="sourceLine" id="cb6-75" title="75"><span class="co">#&gt; 29   29   400.00        52.919         73.440      126.359 0.6847 -0.3787</span></a>
<a class="sourceLine" id="cb6-76" title="76"><span class="co">#&gt; 30   30   400.00        54.488         75.946      130.434 0.6796 -0.3863</span></a>
<a class="sourceLine" id="cb6-77" title="77"><span class="co">#&gt;    LogHR_SE Schoenfeld_Power Frontier_Power RMST_Restrict RMST_Active</span></a>
<a class="sourceLine" id="cb6-78" title="78"><span class="co">#&gt; 1   3.20639           0.0195         0.0250            20          NA</span></a>
<a class="sourceLine" id="cb6-79" title="79"><span class="co">#&gt; 2   1.66272           0.0188         0.0211            20          NA</span></a>
<a class="sourceLine" id="cb6-80" title="80"><span class="co">#&gt; 3   1.13414           0.0196         0.0216            20          NA</span></a>
<a class="sourceLine" id="cb6-81" title="81"><span class="co">#&gt; 4   0.86535           0.0212         0.0227            20          NA</span></a>
<a class="sourceLine" id="cb6-82" title="82"><span class="co">#&gt; 5   0.70206           0.0237         0.0242            20          NA</span></a>
<a class="sourceLine" id="cb6-83" title="83"><span class="co">#&gt; 6   0.59210           0.0270         0.0262            20          NA</span></a>
<a class="sourceLine" id="cb6-84" title="84"><span class="co">#&gt; 7   0.51290           0.0312         0.0286            20          NA</span></a>
<a class="sourceLine" id="cb6-85" title="85"><span class="co">#&gt; 8   0.45307           0.0365         0.0346            20          NA</span></a>
<a class="sourceLine" id="cb6-86" title="86"><span class="co">#&gt; 9   0.40624           0.0429         0.0407            20          NA</span></a>
<a class="sourceLine" id="cb6-87" title="87"><span class="co">#&gt; 10  0.36856           0.0507         0.0482            20          NA</span></a>
<a class="sourceLine" id="cb6-88" title="88"><span class="co">#&gt; 11  0.33758           0.0601         0.0573            20          NA</span></a>
<a class="sourceLine" id="cb6-89" title="89"><span class="co">#&gt; 12  0.31164           0.0712         0.0680            20          NA</span></a>
<a class="sourceLine" id="cb6-90" title="90"><span class="co">#&gt; 13  0.29083           0.0863         0.0825            20          NA</span></a>
<a class="sourceLine" id="cb6-91" title="91"><span class="co">#&gt; 14  0.27436           0.1049         0.1004            20          NA</span></a>
<a class="sourceLine" id="cb6-92" title="92"><span class="co">#&gt; 15  0.26084           0.1265         0.1212            20          NA</span></a>
<a class="sourceLine" id="cb6-93" title="93"><span class="co">#&gt; 16  0.24948           0.1506         0.1447            20          NA</span></a>
<a class="sourceLine" id="cb6-94" title="94"><span class="co">#&gt; 17  0.23975           0.1771         0.1704            20          NA</span></a>
<a class="sourceLine" id="cb6-95" title="95"><span class="co">#&gt; 18  0.23129           0.2057         0.1983            20          NA</span></a>
<a class="sourceLine" id="cb6-96" title="96"><span class="co">#&gt; 19  0.22386           0.2360         0.2280            20          NA</span></a>
<a class="sourceLine" id="cb6-97" title="97"><span class="co">#&gt; 20  0.21725           0.2677         0.2591            20          NA</span></a>
<a class="sourceLine" id="cb6-98" title="98"><span class="co">#&gt; 21  0.21133           0.3006         0.2915            20     17.2073</span></a>
<a class="sourceLine" id="cb6-99" title="99"><span class="co">#&gt; 22  0.20599           0.3342         0.3248            20     17.2073</span></a>
<a class="sourceLine" id="cb6-100" title="100"><span class="co">#&gt; 23  0.20113           0.3683         0.3586            20     17.2073</span></a>
<a class="sourceLine" id="cb6-101" title="101"><span class="co">#&gt; 24  0.19670           0.4025         0.3926            20     17.2073</span></a>
<a class="sourceLine" id="cb6-102" title="102"><span class="co">#&gt; 25  0.19263           0.4366         0.4266            20     17.2073</span></a>
<a class="sourceLine" id="cb6-103" title="103"><span class="co">#&gt; 26  0.18894           0.4705         0.4604            20     17.2073</span></a>
<a class="sourceLine" id="cb6-104" title="104"><span class="co">#&gt; 27  0.18535           0.5034         0.4935            20     17.2073</span></a>
<a class="sourceLine" id="cb6-105" title="105"><span class="co">#&gt; 28  0.18219           0.5357         0.5259            20     17.2073</span></a>
<a class="sourceLine" id="cb6-106" title="106"><span class="co">#&gt; 29  0.17918           0.5670         0.5573            20     17.2073</span></a>
<a class="sourceLine" id="cb6-107" title="107"><span class="co">#&gt; 30  0.17638           0.5971         0.5877            20     17.2073</span></a>
<a class="sourceLine" id="cb6-108" title="108"><span class="co">#&gt;    RMST_Control RMST_Delta RMST_SE RMST_Z RMST_Power RMST_Failure LM_Time</span></a>
<a class="sourceLine" id="cb6-109" title="109"><span class="co">#&gt; 1            NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-110" title="110"><span class="co">#&gt; 2            NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-111" title="111"><span class="co">#&gt; 3            NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-112" title="112"><span class="co">#&gt; 4            NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-113" title="113"><span class="co">#&gt; 5            NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-114" title="114"><span class="co">#&gt; 6            NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-115" title="115"><span class="co">#&gt; 7            NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-116" title="116"><span class="co">#&gt; 8            NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-117" title="117"><span class="co">#&gt; 9            NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-118" title="118"><span class="co">#&gt; 10           NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-119" title="119"><span class="co">#&gt; 11           NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-120" title="120"><span class="co">#&gt; 12           NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-121" title="121"><span class="co">#&gt; 13           NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-122" title="122"><span class="co">#&gt; 14           NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-123" title="123"><span class="co">#&gt; 15           NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-124" title="124"><span class="co">#&gt; 16           NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-125" title="125"><span class="co">#&gt; 17           NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-126" title="126"><span class="co">#&gt; 18           NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-127" title="127"><span class="co">#&gt; 19           NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-128" title="128"><span class="co">#&gt; 20           NA         NA      NA     NA         NA            1      20</span></a>
<a class="sourceLine" id="cb6-129" title="129"><span class="co">#&gt; 21       16.484     0.7233  0.6160 1.1742     0.2160            0      20</span></a>
<a class="sourceLine" id="cb6-130" title="130"><span class="co">#&gt; 22       16.484     0.7233  0.6084 1.1888     0.2203            0      20</span></a>
<a class="sourceLine" id="cb6-131" title="131"><span class="co">#&gt; 23       16.484     0.7233  0.6025 1.2006     0.2238            0      20</span></a>
<a class="sourceLine" id="cb6-132" title="132"><span class="co">#&gt; 24       16.484     0.7233  0.5978 1.2099     0.2266            0      20</span></a>
<a class="sourceLine" id="cb6-133" title="133"><span class="co">#&gt; 25       16.484     0.7233  0.5942 1.2172     0.2288            0      20</span></a>
<a class="sourceLine" id="cb6-134" title="134"><span class="co">#&gt; 26       16.484     0.7233  0.5916 1.2226     0.2305            0      20</span></a>
<a class="sourceLine" id="cb6-135" title="135"><span class="co">#&gt; 27       16.484     0.7233  0.5897 1.2265     0.2316            0      20</span></a>
<a class="sourceLine" id="cb6-136" title="136"><span class="co">#&gt; 28       16.484     0.7233  0.5885 1.2291     0.2324            0      20</span></a>
<a class="sourceLine" id="cb6-137" title="137"><span class="co">#&gt; 29       16.484     0.7233  0.5878 1.2306     0.2329            0      20</span></a>
<a class="sourceLine" id="cb6-138" title="138"><span class="co">#&gt; 30       16.484     0.7233  0.5874 1.2314     0.2331            0      20</span></a>
<a class="sourceLine" id="cb6-139" title="139"><span class="co">#&gt;    LM_Active LM_Control LM_Delta LM_A_SE LM_C_SE LM_D_SE   LM_Z LM_Power</span></a>
<a class="sourceLine" id="cb6-140" title="140"><span class="co">#&gt; 1         NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-141" title="141"><span class="co">#&gt; 2         NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-142" title="142"><span class="co">#&gt; 3         NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-143" title="143"><span class="co">#&gt; 4         NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-144" title="144"><span class="co">#&gt; 5         NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-145" title="145"><span class="co">#&gt; 6         NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-146" title="146"><span class="co">#&gt; 7         NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-147" title="147"><span class="co">#&gt; 8         NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-148" title="148"><span class="co">#&gt; 9         NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-149" title="149"><span class="co">#&gt; 10        NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-150" title="150"><span class="co">#&gt; 11        NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-151" title="151"><span class="co">#&gt; 12        NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-152" title="152"><span class="co">#&gt; 13        NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-153" title="153"><span class="co">#&gt; 14        NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-154" title="154"><span class="co">#&gt; 15        NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-155" title="155"><span class="co">#&gt; 16        NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-156" title="156"><span class="co">#&gt; 17        NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-157" title="157"><span class="co">#&gt; 18        NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-158" title="158"><span class="co">#&gt; 19        NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-159" title="159"><span class="co">#&gt; 20        NA         NA       NA      NA      NA      NA     NA       NA</span></a>
<a class="sourceLine" id="cb6-160" title="160"><span class="co">#&gt; 21    0.7589     0.6703   0.0885  0.0413  0.0481  0.0634 1.3971   0.2868</span></a>
<a class="sourceLine" id="cb6-161" title="161"><span class="co">#&gt; 22    0.7589     0.6703   0.0885  0.0374  0.0429  0.0569 1.5562   0.3432</span></a>
<a class="sourceLine" id="cb6-162" title="162"><span class="co">#&gt; 23    0.7589     0.6703   0.0885  0.0351  0.0399  0.0532 1.6647   0.3839</span></a>
<a class="sourceLine" id="cb6-163" title="163"><span class="co">#&gt; 24    0.7589     0.6703   0.0885  0.0336  0.0379  0.0507 1.7465   0.4155</span></a>
<a class="sourceLine" id="cb6-164" title="164"><span class="co">#&gt; 25    0.7589     0.6703   0.0885  0.0326  0.0365  0.0489 1.8104   0.4405</span></a>
<a class="sourceLine" id="cb6-165" title="165"><span class="co">#&gt; 26    0.7589     0.6703   0.0885  0.0318  0.0354  0.0476 1.8595   0.4600</span></a>
<a class="sourceLine" id="cb6-166" title="166"><span class="co">#&gt; 27    0.7589     0.6703   0.0885  0.0312  0.0347  0.0467 1.8976   0.4751</span></a>
<a class="sourceLine" id="cb6-167" title="167"><span class="co">#&gt; 28    0.7589     0.6703   0.0885  0.0308  0.0341  0.0460 1.9262   0.4865</span></a>
<a class="sourceLine" id="cb6-168" title="168"><span class="co">#&gt; 29    0.7589     0.6703   0.0885  0.0306  0.0337  0.0455 1.9467   0.4947</span></a>
<a class="sourceLine" id="cb6-169" title="169"><span class="co">#&gt; 30    0.7589     0.6703   0.0885  0.0304  0.0334  0.0452 1.9601   0.5001</span></a></code></pre></div>
<p>All of the RMST output columns are prefixed RMST_ . The first column, RMST_Restrict reports the restriction time, then RMST_Active, RMST_Control and RMST_Delta provide the RMST estimates for each arm and the difference between them. Following them, RMST_SE provides the SE for the difference, RMST_Z provides the expected Z score, and RMST_Power the power.Finally, RMST_Failure provides the probability that the RMST calculation will fail due to one or both of the arms having an incalculable RMST (caused by the Survival curve being undefined at the time of restriction).</p>
<p>All of the landmark output columns are prefixed LM_. The first column, LM_Time reports the time of the landmark analysis. LM_Active and LM_Control then give the estimates of S(t) for each arm, and LM_Delta that for the difference. LM_A_SE, LM_C_SE and LM_D_SE then give the corresponding standard errors. Finally LM_Z and LM_Power provide the expected Z score and power.</p>
</div>
<div id="plotting-nph_traj-output" class="section level3">
<h3>3.6 Plotting nph_traj Output</h3>
<p>A plotting function, plot_npht is available to provide some commonly-useful trajectory plots for nph_traj output.</p>
<p>By default, this produces plots of the Survival functions for the event distributions (a KM plot), the CDFs of the censoring distributions, recruited patients over time, expected total events over time, expected HR over time (with predicted CI), and a plot of power over time for all available methods in the data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># Plot output from nph_traj</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">plot_npht</span>(output2)</a></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<p>The first three of these are useful for checking assumptions, to e.g. check that the distributions are reasonable and what was wanted. The expected event plot is helpful for setting expectations for trial conduct of event numbers. The logHR plot is useful in non-proportional hazards trials for looking at how the expected HR will change over time; the predicted CI for it also allows a straightforward observation of the time at which the HR will become significant. Finally, the power plot allows the evolution of the power over time to be observed, and comparisons to be made between the different analysis methods.</p>
<p>All plots are produced by default, but each individual plot may be disabled via arguments, and likewise arguments may be used to prevent the plotting of individual trajectories from the power plot. Standard plotting arguments may also be passed to it, e.g. regarding text size.</p>
</div>
</div>
<div id="simulating-trial-properties" class="section level2">
<h2>4 Simulating Trial Properties</h2>
<div id="simulating-data-simulate_trials" class="section level3">
<h3>4.1 Simulating Data: simulate_trials</h3>
<p>Simulating trials is an alternative to direct property calculation. As it is much slower, introduces Monte Carlo error and can only simulate one assessment time per run, it is recommended to use it primarily to check analytic results from nph_traj or as a starting point for simulating more complex cases that are beyond the scope of nph_traj.</p>
<p>Syntax for simulate_trials is very similar to that of nph_traj, and the same Curves and RCurve can be passed to it via the same argument names (e.g. ‘active_ecurve’; see section 3.1 for more details). As with nph_traj, it is minimally required to specify distribution Curve objects for the active and control arms, as well as an RCurve object describing the recruitment. For further details on Curve/RCurve objects, please see section 2.</p>
<p>In addition to these similar inputs, two simulation-specific arguments are also required; the number of simulation iterations to run (‘iterations’) and the random seed to use (‘seed’). Finally, it is also necessary to specify either a time (‘assess’), or a fixed number of events (‘fix_events’) to analyse at. If both are specified, the fixed event number will be used.</p>
<p>Four columns are produced in the output matrix; ‘Time’, which gives the time, ‘Censored’, which gives the censoring indicator (where 1 is patient was censored), ‘Trt’, which gives the treatment number, and ‘Iter’, which is the iteration number.</p>
<p>A simple example corresponding to the first example from the nph_traj section is given here:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># Simple simulation corresponding to first example of nph_traj</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co"># Number of iterations kept unrealistically low to reduce processing time</span></a>
<a class="sourceLine" id="cb8-3" title="3">simulation1 &lt;-<span class="st"> </span><span class="kw">simulate_trials</span>(<span class="dt">active_ecurve=</span>activeCurve,<span class="dt">control_ecurve=</span>controlCurve,<span class="dt">rcurve=</span>rcurve3,<span class="dt">assess=</span><span class="dv">10</span>,<span class="dt">iterations=</span><span class="dv">100</span>,<span class="dt">seed=</span><span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">#&gt; Note: assessment time is shorter than the length of the recruitment period:12. Any attempt to increase the assessment time at a later date will result in missing patients!</span></a></code></pre></div>
<p>Using the same syntax as nph_traj, you can also specify censoring distributions that control dropout by providing Curve objects to the two dcurve arguments.</p>
<p>Also similar to nph_traj, more detailed output can be requested (‘detailed_output=TRUE’), which includes the times for events and censorings that were not observed because something else happened first. For most purposes this extra detail is not required, but it can be useful for checking distributions and it is required if you later want to change the time of assessment (or fixed event number). Functions to change assessment times will be covered in section 4.2.</p>
<p>Two formats of simulated data are supported by gestate; matrix and list format. In the default matrix format, all simulated data is present in a single table. In list format, each iteration is separated into its own table within a list and the Iter column is omitted. The ‘output_type’ argument controls which is produced. Both formats are automatically supported by analyse_sim.</p>
<p>When performing large simulations in R, all data is held within RAM. Efforts has been taken to reduce the RAM usage of gestate’s simulations, but large simulations (&gt;10,000) will still require a large quantity of available system memory; exceeding this typically leads to excessive slowdowns and eventually system crashes. Considerable RAM savings can be made by using the list format and not using detailed output, so these are recommended for large ‘production’ simulations; together these options save about 2/3rds of the RAM footprint compared to detailed output in matrix format.</p>
<p>A more complicated example showing the additional options and based on the second and third examples from the nph_traj section is presented here:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Simple simulation corresponding to first example of nph_traj</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co"># Number of iterations kept unrealistically low to reduce processing time</span></a>
<a class="sourceLine" id="cb9-3" title="3">simulation2 &lt;-<span class="st"> </span><span class="kw">simulate_trials</span>(<span class="dt">active_ecurve=</span>activeCurveNPH,<span class="dt">control_ecurve=</span>controlCurveNPH,<span class="dt">active_dcurve=</span>censorCurveA,<span class="dt">control_dcurve=</span>censorCurveC,<span class="dt">rcurve=</span>rcurve3,<span class="dt">fix_events=</span><span class="dv">100</span>,<span class="dt">iterations=</span><span class="dv">100</span>,<span class="dt">seed=</span><span class="dv">12345</span>,<span class="dt">detailed_output =</span> <span class="ot">TRUE</span>,<span class="dt">output_type =</span> <span class="st">&quot;list&quot;</span>)</a></code></pre></div>
</div>
<div id="simulating-stratified-data-simulate_trials_strata" class="section level3">
<h3>4.2 Simulating Stratified Data: simulate_trials_strata</h3>
<p>Sometimes it is believed that there are important covariates in a trial or that there is heterogeneity of treatment effect between different patient strata. simulate_trials_strata is available to simulate this.</p>
<p>simulate_trials_strata acts as a wrapper for simulate_trials; consequently syntax is almost identical, with two main exceptions:</p>
<p>Firstly there are two additional arguments; ‘stratum_probs’ and ‘stratum_name’. The first is a required vector summing to 1 that contains the probability of a patient belonging to each stratum, with entries corresponding to each stratum required. If ‘stratum_probs’ does not sum to 1, an error will be produced. The second is optional and gives the name of the column with the stratum variable in.</p>
<p>The other main syntax difference is that each of the four arguments requiring Curve objects instead now instead takes a list of Curve objects. If a single Curve is supplied to a given argument, it will be shared across all strata (this is commonly done for the censoring arguments). Otherwise, the list should be of the same length as the ‘stratum_probs’. In this case, the Curve objects provide the distributions for events or censorings within their arm for their respective strata only.</p>
<p>A simple example is as follows:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># Define a Curve list for the active arm but keep just a single value for the control arm, to represent a predictive covariate.</span></a>
<a class="sourceLine" id="cb10-2" title="2">activeCurveStrata &lt;-<span class="st"> </span><span class="kw">c</span>(activeCurve, <span class="kw">Weibull</span>(<span class="dt">alpha=</span><span class="dv">100</span>,<span class="dt">beta=</span><span class="fl">0.8</span>))</a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4">simulation3 &lt;-<span class="st"> </span><span class="kw">simulate_trials_strata</span>(<span class="dt">stratum_probs=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>),<span class="dt">active_ecurve=</span>activeCurveStrata,<span class="dt">control_ecurve=</span>controlCurve,<span class="dt">rcurve=</span>rcurve3, <span class="dt">assess=</span><span class="dv">10</span>,<span class="dt">iterations=</span><span class="dv">100</span>,<span class="dt">seed=</span><span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">#&gt; Note: assessment time is shorter than the length of the recruitment period:12. Any attempt to increase the assessment time at a later date will result in missing patients!</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co">#&gt; Note: assessment time is shorter than the length of the recruitment period:12. Any attempt to increase the assessment time at a later date will result in missing patients!</span></a></code></pre></div>
</div>
<div id="modifying-simulated-data-set_event_number-and-set_assess_time" class="section level3">
<h3>4.3 Modifying Simulated Data: set_event_number and set_assess_time</h3>
<p>Once simulations are complete, they may be analysed straight away. However sometimes it is desirable to first modify the data. gestate V1.3.x has two functions available to do this; ‘set_event_number’ and ‘set_assess_time’. These can be used to modify the assessment times to respectively either a fixed event number or a given assessment time. Both are usable on simulations previously using either approach, so long as detailed output is available. By keeping the data’s existing assessment criteria, it is also possible to just use these functions to change the format of the data from matrix to list, or vice versa.</p>
<p>There is one caveat; Patients that have not yet entered the trial at the time of assessment are always excluded from the data set. If the current assessment time for an iteration is before the maximum recruitment time, then any increases in assessment time will lead to errors caused by these missing patients. This is straightforward to check if the original data has a fixed assessment time, but can be awkward if a fixed event number was specified as the assessment time will vary between iterations. It is recommended therefore to only apply it to fixed event simulations if either the pre-existing number of events is sufficiently large that no iteration is still in the recruitment period, or if the number of events is being reduced (rather than a fixed time being set).</p>
<p>Using either function is straightforward; provide the name of the simulated data set as an argument to the relevant function, then the new time / event number. By default the output format will be the same as that entered, and detailed output will remain. Both of these may be changed by the same arguments discussed in the previous section.</p>
<p>Two examples:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># Increase the number of events for simulation 2</span></a>
<a class="sourceLine" id="cb11-2" title="2">simulation2a &lt;-<span class="st"> </span><span class="kw">set_event_number</span>(<span class="dt">data=</span>simulation2,<span class="dt">events=</span><span class="dv">120</span>)</a>
<a class="sourceLine" id="cb11-3" title="3"></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#Rerun simulation 1 with detailed output specified</span></a>
<a class="sourceLine" id="cb11-5" title="5">simulation1a &lt;-<span class="st"> </span><span class="kw">simulate_trials</span>(<span class="dt">active_ecurve=</span>activeCurve,<span class="dt">control_ecurve=</span>controlCurve,<span class="dt">rcurve=</span>rcurve3,<span class="dt">assess=</span><span class="dv">10</span>,<span class="dt">iterations=</span><span class="dv">100</span>,<span class="dt">seed=</span><span class="dv">1234</span>,<span class="dt">detailed_output=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&gt; Note: assessment time is shorter than the length of the recruitment period:12. Any attempt to increase the assessment time at a later date will result in missing patients!</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co"># Retain the assessment time for simulation 1 at 10, but convert to a list format with simple output</span></a>
<a class="sourceLine" id="cb11-8" title="8">simulation1b &lt;-<span class="st"> </span><span class="kw">set_assess_time</span>(<span class="dt">data=</span>simulation1a,<span class="dt">time=</span><span class="dv">10</span>,<span class="dt">output_type=</span><span class="st">&quot;list&quot;</span>,<span class="dt">detailed_output =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="analysing-simulated-data-analyse_sim" class="section level3">
<h3>4.4 Analysing Simulated Data: analyse_sim</h3>
<p>analyse_sim can be used to analyse data simulated by gestate. It is designed to automatically detect the input formats and provide minimal-fuss analysis. To perform a log-rank test and Cox regression is thus simply:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># Perform log-rank test and Cox regression on simulated data</span></a>
<a class="sourceLine" id="cb12-2" title="2">analysis1 &lt;-<span class="st"> </span><span class="kw">analyse_sim</span>(simulation1)</a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">head</span>(analysis1)</a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#&gt;                 HR      LogHR  LogHR_SE       HR_Z        HR_P       LR_Z</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&gt; result.1 0.8860301 -0.1210044 0.2123402 -0.5698611 0.284385967 -0.5702067</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">#&gt; result.2 0.6544765 -0.4239196 0.2004611 -2.1147227 0.017226794 -2.1303437</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">#&gt; result.3 0.8233719 -0.1943473 0.1977909 -0.9825896 0.162904737 -0.9841202</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt; result.4 0.5907935 -0.5262887 0.1988439 -2.6467425 0.004063560 -2.6771595</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; result.5 0.5676261 -0.5662923 0.1848233 -3.0639662 0.001092118 -3.1042636</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt; result.6 0.6570256 -0.4200323 0.1994501 -2.1059516 0.017604278 -2.1213151</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt;                  LR_P Events_Active Events_Control</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt; result.1 0.2842687721            43             46</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt; result.2 0.0165716240            44             58</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt; result.3 0.1625282124            46             58</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&gt; result.4 0.0037124640            42             64</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co">#&gt; result.5 0.0009537665            52             68</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co">#&gt; result.6 0.0169476461            43             61</span></a></code></pre></div>
<p>analyse_sim produces a matrix with each row containing the results of one iteration. For Cox regression, output is produced for the HR and log-HR as well as its standard error, Z score and p-value. For the log-rank test the Z score and p-value are returned. The number of events in each arm is also produced,</p>
<p>Stratified analysis for a single variable (covariate adjustment for Cox) is also supported by using the ‘stratum’ argument to provide the column name of the stratification variable:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># Perform stratified log-rank test and covariate-adjusted Cox regression on simulated data</span></a>
<a class="sourceLine" id="cb13-2" title="2">analysis3 &lt;-<span class="st"> </span><span class="kw">analyse_sim</span>(<span class="dt">data=</span>simulation3, <span class="dt">stratum=</span><span class="st">&quot;Stratum&quot;</span>)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">head</span>(analysis3)</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co">#&gt;                 HR      LogHR  LogHR_SE      HR_Z         HR_P      LR_Z</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co">#&gt; result.1 0.4983595 -0.6964335 0.2161342 -3.222228 0.0006359899 -3.190611</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co">#&gt; result.2 0.5574817 -0.5843256 0.2163308 -2.701074 0.0034557975 -2.618753</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">#&gt; result.3 0.5163259 -0.6610170 0.2027848 -3.259698 0.0005576546 -3.253905</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">#&gt; result.4 0.4923199 -0.7086266 0.2256932 -3.139778 0.0008453787 -3.244950</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co">#&gt; result.5 0.5134030 -0.6666942 0.2197812 -3.033446 0.0012088916 -3.126863</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">#&gt; result.6 0.5207889 -0.6524105 0.2104464 -3.100127 0.0009671883 -3.060615</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co">#&gt;                  LR_P Events_Active Events_Control</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">#&gt; result.1 0.0007098606            34             61</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co">#&gt; result.2 0.0044125890            36             55</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">#&gt; result.3 0.0005691522            38             68</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="co">#&gt; result.4 0.0005873565            30             57</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="co">#&gt; result.5 0.0008834111            31             64</span></a>
<a class="sourceLine" id="cb13-17" title="17"><span class="co">#&gt; result.6 0.0011044150            37             59</span></a></code></pre></div>
<p>Landmark and RMST analysis may also be requested by specifying the landmark and restriction times respectively to the ‘landmark’ and ‘RMST’ arguments, (the same syntax as nph_traj). RMST analysis is performed using the survrm2 package, while landmark analysis uses the Greenwood standard error approach.</p>
<p>To speed up analysis, gestate supports parallel processing through the doParallel package. If this is installed then the ‘parallel_cores’ argument may be set to the required number of cores.</p>
<p>A final example is:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># Perform log-rank test, Cox regression, landmark analysis and RMST analysis on simulated data using parallel processing.</span></a>
<a class="sourceLine" id="cb14-2" title="2">analysis2 &lt;-<span class="st"> </span><span class="kw">analyse_sim</span>(<span class="dt">data=</span>simulation2, <span class="dt">RMST=</span><span class="dv">10</span>, <span class="dt">landmark=</span><span class="dv">10</span>, <span class="dt">parallel_cores=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="kw">head</span>(analysis2)</a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co">#&gt;                 HR       LogHR  LogHR_SE       HR_Z         HR_P</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="co">#&gt; result.1 0.9741865 -0.02615254 0.2000819 -0.1307092 0.4480026661</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="co">#&gt; result.2 0.8666650 -0.14310281 0.2003264 -0.7143482 0.2375059393</span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="co">#&gt; result.3 0.6853549 -0.37781849 0.2024118 -1.8665836 0.0309798814</span></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="co">#&gt; result.4 0.7639749 -0.26922032 0.2015036 -1.3360573 0.0907652693</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="co">#&gt; result.5 0.5216262 -0.65080409 0.2072831 -3.1396877 0.0008456401</span></a>
<a class="sourceLine" id="cb14-10" title="10"><span class="co">#&gt; result.6 0.7821452 -0.24571494 0.2010825 -1.2219610 0.1108611870</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="co">#&gt;                LR_Z         LR_P Events_Active Events_Control</span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="co">#&gt; result.1 -0.1307129 0.4480011946            49             51</span></a>
<a class="sourceLine" id="cb14-13" title="13"><span class="co">#&gt; result.2 -0.7149549 0.2373184580            48             52</span></a>
<a class="sourceLine" id="cb14-14" title="14"><span class="co">#&gt; result.3 -1.8775705 0.0302199738            43             57</span></a>
<a class="sourceLine" id="cb14-15" title="15"><span class="co">#&gt; result.4 -1.3400901 0.0901080329            44             56</span></a>
<a class="sourceLine" id="cb14-16" title="16"><span class="co">#&gt; result.5 -3.1951239 0.0006988541            37             63</span></a>
<a class="sourceLine" id="cb14-17" title="17"><span class="co">#&gt; result.6 -1.2250305 0.1102818733            45             55</span></a>
<a class="sourceLine" id="cb14-18" title="18"><span class="co">#&gt;          RMST_Restrict RMST_Active RMST_A_SE RMST_Control RMST_C_SE</span></a>
<a class="sourceLine" id="cb14-19" title="19"><span class="co">#&gt; result.1            10    8.894469 0.1908676     9.200848 0.1544769</span></a>
<a class="sourceLine" id="cb14-20" title="20"><span class="co">#&gt; result.2            10    9.115089 0.1659930     9.048694 0.1737710</span></a>
<a class="sourceLine" id="cb14-21" title="21"><span class="co">#&gt; result.3            10    9.467461 0.1291302     9.223193 0.1568467</span></a>
<a class="sourceLine" id="cb14-22" title="22"><span class="co">#&gt; result.4            10    9.024831 0.1765084     8.969905 0.1658831</span></a>
<a class="sourceLine" id="cb14-23" title="23"><span class="co">#&gt; result.5            10    9.478867 0.1213474     8.969737 0.1815976</span></a>
<a class="sourceLine" id="cb14-24" title="24"><span class="co">#&gt; result.6            10    9.157045 0.1733281     8.924620 0.1764223</span></a>
<a class="sourceLine" id="cb14-25" title="25"><span class="co">#&gt;           RMST_Delta RMST_D_SE     RMST_Z      RMST_P LM_Time LM_Active</span></a>
<a class="sourceLine" id="cb14-26" title="26"><span class="co">#&gt; result.1 -0.30637988 0.2455475 -1.2477419 0.893937212      10 0.8288031</span></a>
<a class="sourceLine" id="cb14-27" title="27"><span class="co">#&gt; result.2  0.06639462 0.2403124  0.2762846 0.391164727      10 0.8386908</span></a>
<a class="sourceLine" id="cb14-28" title="28"><span class="co">#&gt; result.3  0.24426754 0.2031637  1.2023187 0.114620035      10 0.8895153</span></a>
<a class="sourceLine" id="cb14-29" title="29"><span class="co">#&gt; result.4  0.05492567 0.2422239  0.2267558 0.410306813      10 0.8196045</span></a>
<a class="sourceLine" id="cb14-30" title="30"><span class="co">#&gt; result.5  0.50912949 0.2184099  2.3310738 0.009874735      10 0.8945876</span></a>
<a class="sourceLine" id="cb14-31" title="31"><span class="co">#&gt; result.6  0.23242511 0.2473205  0.9397728 0.173667053      10 0.8650000</span></a>
<a class="sourceLine" id="cb14-32" title="32"><span class="co">#&gt;             LM_A_SE LM_Control    LM_C_SE     LM_Delta    LM_D_SE</span></a>
<a class="sourceLine" id="cb14-33" title="33"><span class="co">#&gt; result.1 0.02673240  0.8385181 0.02615064 -0.009714975 0.03739622</span></a>
<a class="sourceLine" id="cb14-34" title="34"><span class="co">#&gt; result.2 0.02612384  0.8331164 0.02652844  0.005574430 0.03723188</span></a>
<a class="sourceLine" id="cb14-35" title="35"><span class="co">#&gt; result.3 0.02221686  0.8593153 0.02465128  0.030200029 0.03318546</span></a>
<a class="sourceLine" id="cb14-36" title="36"><span class="co">#&gt; result.4 0.02722308  0.7917703 0.02896078  0.027834189 0.03974698</span></a>
<a class="sourceLine" id="cb14-37" title="37"><span class="co">#&gt; result.5 0.02175786  0.8124251 0.02780837  0.082162579 0.03530878</span></a>
<a class="sourceLine" id="cb14-38" title="38"><span class="co">#&gt; result.6 0.02416351  0.8098204 0.02776559  0.055179641 0.03680765</span></a>
<a class="sourceLine" id="cb14-39" title="39"><span class="co">#&gt;                LM_Z        LM_P</span></a>
<a class="sourceLine" id="cb14-40" title="40"><span class="co">#&gt; result.1 -0.2597850 0.602485182</span></a>
<a class="sourceLine" id="cb14-41" title="41"><span class="co">#&gt; result.2  0.1497220 0.440491988</span></a>
<a class="sourceLine" id="cb14-42" title="42"><span class="co">#&gt; result.3  0.9100380 0.181401230</span></a>
<a class="sourceLine" id="cb14-43" title="43"><span class="co">#&gt; result.4  0.7002843 0.241874875</span></a>
<a class="sourceLine" id="cb14-44" title="44"><span class="co">#&gt; result.5  2.3269728 0.009983358</span></a>
<a class="sourceLine" id="cb14-45" title="45"><span class="co">#&gt; result.6  1.4991353 0.066919273</span></a></code></pre></div>
<p>For both landmark and RMST analyses, estimates are returned for each arm and the difference between them. Standard errors for all three quantities are produced, along with the Z score and p-value.</p>
</div>
<div id="summarising-analysed-data-summarise_analysis" class="section level3">
<h3>4.5 Summarising Analysed Data: summarise_analysis</h3>
<p>summarise_analysis is a function to summarise the results from multiple simulation iterations. It reads in the output from analyse_sim and automatically detects which analyses have been performed, adjusting its output as necessary. Apart from the name of the input analysis data, the only parameter is ‘alpha1’, which corresponds to the one-sided alpha level for power calculations. By default this is 0.025 (i.e. 2.5% 1-sided alpha)</p>
<p>An example call is:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co"># Summarise analysis from analysis2 output</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="kw">summarise_analysis</span>(analysis2)</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co">#&gt;   Simulations     HR   LogHR LogHR_SE    HR_Z   HR_P HR_Power HR_Failed</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co">#&gt; 1         100 0.7011 -0.3551  0.20356 -1.7302 0.0418     0.41         0</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="co">#&gt;      LR_Z   LR_P LR_Power LR_Failed Events_Active Events_Control</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="co">#&gt; 1 -1.7488 0.0402     0.41         0          42.3           57.7</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="co">#&gt;   Events_Total RMST_Restrict RMST_Active RMST_A_SE RMST_Control RMST_C_SE</span></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="co">#&gt; 1          100            10      9.1772    0.1624       9.0525    0.1664</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="co">#&gt;   RMST_Delta RMST_D_SE RMST_Power RMST_Failed LM_Time LM_Active LM_A_SE</span></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="co">#&gt; 1     0.1247    0.2325       0.04           0      10    0.8554  0.0249</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co">#&gt;   LM_Control LM_C_SE LM_Delta LM_D_SE LM_Power LM_Failed</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="co">#&gt; 1     0.8167  0.0275   0.0387  0.0371     0.17         0</span></a></code></pre></div>
<p>The output table contains a summary across all iterations of the simulation, with overall values and power. For Cox regression, the HR and logHR and SE of the logHR are produced, along with the average Z score, p-value and power. For the log-rank test, the average Z score, p value and power are returned. Failure rates (probability of analysis failure) for each are also given. If RMST and/or landmark analysis were previously requested, average values and SEs are given for each arm and the difference between arms. The powers and probabilities of analysis failure are also given.</p>
</div>
<div id="comparisons-of-simulated-data-to-analytic-outputs" class="section level3">
<h3>4.6 Comparisons of Simulated Data to Analytic Outputs</h3>
<p>Simulation may be used to validate analytic results; A simple workflow to compare outputs from nph_traj and summarise_analysis might look like the following:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># Run analytic planning and select a suitable time</span></a>
<a class="sourceLine" id="cb16-2" title="2">outputX &lt;-<span class="st"> </span><span class="kw">nph_traj</span>(<span class="dt">active_ecurve=</span>activeCurveNPH, <span class="dt">control_ecurve=</span>controlCurveNPH, <span class="dt">rcurve=</span>rcurve3, <span class="dt">max_assessment=</span><span class="dv">50</span>, <span class="dt">RMST=</span><span class="dv">40</span>, <span class="dt">landmark=</span><span class="dv">40</span>)</a>
<a class="sourceLine" id="cb16-3" title="3">outputX<span class="op">$</span>Summary[<span class="dv">41</span><span class="op">:</span><span class="dv">50</span>,]</a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co">#&gt;    Time Patients Events_Active Events_Control Events_Total     HR   LogHR</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="co">#&gt; 41   41      400        70.009        100.444      170.453 0.6366 -0.4517</span></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="co">#&gt; 42   42      400        71.284        102.416      173.700 0.6336 -0.4564</span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="co">#&gt; 43   43      400        72.539        104.348      176.887 0.6307 -0.4610</span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="co">#&gt; 44   44      400        73.776        106.242      180.018 0.6279 -0.4654</span></a>
<a class="sourceLine" id="cb16-9" title="9"><span class="co">#&gt; 45   45      400        74.994        108.099      183.093 0.6252 -0.4697</span></a>
<a class="sourceLine" id="cb16-10" title="10"><span class="co">#&gt; 46   46      400        76.194        109.919      186.113 0.6226 -0.4739</span></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="co">#&gt; 47   47      400        77.377        111.702      189.079 0.6201 -0.4779</span></a>
<a class="sourceLine" id="cb16-12" title="12"><span class="co">#&gt; 48   48      400        78.543        113.451      191.994 0.6176 -0.4818</span></a>
<a class="sourceLine" id="cb16-13" title="13"><span class="co">#&gt; 49   49      400        79.692        115.164      194.856 0.6153 -0.4856</span></a>
<a class="sourceLine" id="cb16-14" title="14"><span class="co">#&gt; 50   50      400        80.825        116.844      197.669 0.6130 -0.4893</span></a>
<a class="sourceLine" id="cb16-15" title="15"><span class="co">#&gt;    LogHR_SE Schoenfeld_Power Frontier_Power RMST_Restrict RMST_Active</span></a>
<a class="sourceLine" id="cb16-16" title="16"><span class="co">#&gt; 41  0.15424           0.8386         0.8333            40     30.9011</span></a>
<a class="sourceLine" id="cb16-17" title="17"><span class="co">#&gt; 42  0.15277           0.8526         0.8477            40     30.9011</span></a>
<a class="sourceLine" id="cb16-18" title="18"><span class="co">#&gt; 43  0.15137           0.8655         0.8610            40     30.9011</span></a>
<a class="sourceLine" id="cb16-19" title="19"><span class="co">#&gt; 44  0.15003           0.8774         0.8733            40     30.9011</span></a>
<a class="sourceLine" id="cb16-20" title="20"><span class="co">#&gt; 45  0.14874           0.8884         0.8845            40     30.9011</span></a>
<a class="sourceLine" id="cb16-21" title="21"><span class="co">#&gt; 46  0.14751           0.8984         0.8948            40     30.9011</span></a>
<a class="sourceLine" id="cb16-22" title="22"><span class="co">#&gt; 47  0.14632           0.9076         0.9043            40     30.9011</span></a>
<a class="sourceLine" id="cb16-23" title="23"><span class="co">#&gt; 48  0.14518           0.9159         0.9129            40     30.9011</span></a>
<a class="sourceLine" id="cb16-24" title="24"><span class="co">#&gt; 49  0.14408           0.9236         0.9208            40     30.9011</span></a>
<a class="sourceLine" id="cb16-25" title="25"><span class="co">#&gt; 50  0.14303           0.9306         0.9280            40     30.9011</span></a>
<a class="sourceLine" id="cb16-26" title="26"><span class="co">#&gt;    RMST_Control RMST_Delta RMST_SE RMST_Z RMST_Power RMST_Failure LM_Time</span></a>
<a class="sourceLine" id="cb16-27" title="27"><span class="co">#&gt; 41      27.5336     3.3675  1.3992 2.4067     0.6725        5e-04      40</span></a>
<a class="sourceLine" id="cb16-28" title="28"><span class="co">#&gt; 42      27.5336     3.3675  1.3959 2.4124     0.6745        0e+00      40</span></a>
<a class="sourceLine" id="cb16-29" title="29"><span class="co">#&gt; 43      27.5336     3.3675  1.3933 2.4170     0.6762        0e+00      40</span></a>
<a class="sourceLine" id="cb16-30" title="30"><span class="co">#&gt; 44      27.5336     3.3675  1.3912 2.4206     0.6775        0e+00      40</span></a>
<a class="sourceLine" id="cb16-31" title="31"><span class="co">#&gt; 45      27.5336     3.3675  1.3896 2.4234     0.6785        0e+00      40</span></a>
<a class="sourceLine" id="cb16-32" title="32"><span class="co">#&gt; 46      27.5336     3.3675  1.3884 2.4255     0.6792        0e+00      40</span></a>
<a class="sourceLine" id="cb16-33" title="33"><span class="co">#&gt; 47      27.5336     3.3675  1.3875 2.4270     0.6798        0e+00      40</span></a>
<a class="sourceLine" id="cb16-34" title="34"><span class="co">#&gt; 48      27.5336     3.3675  1.3869 2.4280     0.6801        0e+00      40</span></a>
<a class="sourceLine" id="cb16-35" title="35"><span class="co">#&gt; 49      27.5336     3.3675  1.3866 2.4286     0.6803        0e+00      40</span></a>
<a class="sourceLine" id="cb16-36" title="36"><span class="co">#&gt; 50      27.5336     3.3675  1.3864 2.4289     0.6805        0e+00      40</span></a>
<a class="sourceLine" id="cb16-37" title="37"><span class="co">#&gt;    LM_Active LM_Control LM_Delta LM_A_SE LM_C_SE LM_D_SE   LM_Z LM_Power</span></a>
<a class="sourceLine" id="cb16-38" title="38"><span class="co">#&gt; 41    0.6185     0.4493   0.1692  0.0416  0.0452  0.0615 2.7516   0.7857</span></a>
<a class="sourceLine" id="cb16-39" title="39"><span class="co">#&gt; 42    0.6185     0.4493   0.1692  0.0390  0.0416  0.0570 2.9679   0.8432</span></a>
<a class="sourceLine" id="cb16-40" title="40"><span class="co">#&gt; 43    0.6185     0.4493   0.1692  0.0375  0.0396  0.0545 3.1047   0.8738</span></a>
<a class="sourceLine" id="cb16-41" title="41"><span class="co">#&gt; 44    0.6185     0.4493   0.1692  0.0365  0.0382  0.0528 3.2014   0.8928</span></a>
<a class="sourceLine" id="cb16-42" title="42"><span class="co">#&gt; 45    0.6185     0.4493   0.1692  0.0358  0.0373  0.0517 3.2731   0.9054</span></a>
<a class="sourceLine" id="cb16-43" title="43"><span class="co">#&gt; 46    0.6185     0.4493   0.1692  0.0353  0.0366  0.0509 3.3269   0.9142</span></a>
<a class="sourceLine" id="cb16-44" title="44"><span class="co">#&gt; 47    0.6185     0.4493   0.1692  0.0350  0.0361  0.0502 3.3671   0.9203</span></a>
<a class="sourceLine" id="cb16-45" title="45"><span class="co">#&gt; 48    0.6185     0.4493   0.1692  0.0347  0.0357  0.0498 3.3968   0.9246</span></a>
<a class="sourceLine" id="cb16-46" title="46"><span class="co">#&gt; 49    0.6185     0.4493   0.1692  0.0345  0.0355  0.0495 3.4177   0.9275</span></a>
<a class="sourceLine" id="cb16-47" title="47"><span class="co">#&gt; 50    0.6185     0.4493   0.1692  0.0344  0.0353  0.0493 3.4312   0.9294</span></a></code></pre></div>
<p>We select 47 months as it gives 90% power for LR/Cox and specify 2000 simulations (this is due to technical limitations in vignette creation; typically 10,000+ are recommended):</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># Run simulation, analysis, summary at chosen time</span></a>
<a class="sourceLine" id="cb17-2" title="2">simulationX &lt;-<span class="st"> </span><span class="kw">simulate_trials</span>(<span class="dt">active_ecurve=</span>activeCurveNPH, <span class="dt">control_ecurve=</span>controlCurveNPH, <span class="dt">rcurve=</span>rcurve3, <span class="dt">assess=</span><span class="dv">47</span>, <span class="dt">seed=</span><span class="dv">123456</span>, <span class="dt">iterations =</span> <span class="dv">2000</span>, <span class="dt">output_type=</span><span class="st">&quot;list&quot;</span>)</a>
<a class="sourceLine" id="cb17-3" title="3">analysisX   &lt;-<span class="st"> </span><span class="kw">analyse_sim</span>(simulationX,<span class="dt">RMST=</span><span class="dv">40</span>,<span class="dt">landmark=</span><span class="dv">40</span>)</a>
<a class="sourceLine" id="cb17-4" title="4">summaryX    &lt;-<span class="st"> </span><span class="kw">summarise_analysis</span>(analysisX)</a></code></pre></div>
<p>We can now pair results up and directly compare them between methods:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="co"># Run simulation, analysis, summary at chosen time</span></a>
<a class="sourceLine" id="cb18-2" title="2">A &lt;-<span class="st"> </span>outputX<span class="op">$</span>Summary[<span class="dv">47</span>,]</a>
<a class="sourceLine" id="cb18-3" title="3">B &lt;-<span class="st"> </span>summaryX</a>
<a class="sourceLine" id="cb18-4" title="4">Events_Active &lt;-<span class="st"> </span><span class="kw">c</span>(A<span class="op">$</span>Events_Active,B<span class="op">$</span>Events_Active)</a>
<a class="sourceLine" id="cb18-5" title="5">Events_Control &lt;-<span class="st"> </span><span class="kw">c</span>(A<span class="op">$</span>Events_Control,B<span class="op">$</span>Events_Control)</a>
<a class="sourceLine" id="cb18-6" title="6">Events_Total &lt;-<span class="st"> </span><span class="kw">c</span>(A<span class="op">$</span>Events_Total,B<span class="op">$</span>Events_Total)</a>
<a class="sourceLine" id="cb18-7" title="7">HR &lt;-<span class="st"> </span><span class="kw">c</span>(A<span class="op">$</span>HR,B<span class="op">$</span>HR)</a>
<a class="sourceLine" id="cb18-8" title="8">LogHR &lt;-<span class="st"> </span><span class="kw">c</span>(A<span class="op">$</span>LogHR,B<span class="op">$</span>LogHR)</a>
<a class="sourceLine" id="cb18-9" title="9">LogHR_SE &lt;-<span class="st"> </span><span class="kw">c</span>(A<span class="op">$</span>LogHR_SE,B<span class="op">$</span>LogHR_SE)</a>
<a class="sourceLine" id="cb18-10" title="10">LR_Power &lt;-<span class="st"> </span><span class="kw">c</span>(A<span class="op">$</span>Schoenfeld_Power,B<span class="op">$</span>Power_LR)</a>
<a class="sourceLine" id="cb18-11" title="11">RMST &lt;-<span class="kw">c</span>(A<span class="op">$</span>RMST_Delta,B<span class="op">$</span>RMST_Delta)</a>
<a class="sourceLine" id="cb18-12" title="12">RMST_SE &lt;-<span class="kw">c</span>(A<span class="op">$</span>RMST_SE,B<span class="op">$</span>RMST_D_SE)</a>
<a class="sourceLine" id="cb18-13" title="13">RMST_Power &lt;-<span class="st"> </span><span class="kw">c</span>(A<span class="op">$</span>RMST_Power,B<span class="op">$</span>RMST_Power)</a>
<a class="sourceLine" id="cb18-14" title="14">Landmark &lt;-<span class="st"> </span><span class="kw">c</span>(A<span class="op">$</span>LM_Delta,B<span class="op">$</span>LM_Delta)</a>
<a class="sourceLine" id="cb18-15" title="15">Landmark_SE &lt;-<span class="st"> </span><span class="kw">c</span>(A<span class="op">$</span>LM_D_SE,B<span class="op">$</span>LM_D_SE)</a>
<a class="sourceLine" id="cb18-16" title="16">Landmark_Power &lt;-<span class="st"> </span><span class="kw">c</span>(A<span class="op">$</span>LM_Power,B<span class="op">$</span>LM_Power)</a>
<a class="sourceLine" id="cb18-17" title="17">collated &lt;-<span class="st"> </span><span class="kw">rbind</span>(Events_Active,Events_Control,Events_Total,HR,LogHR,LogHR_SE,LR_Power,RMST, RMST_SE, RMST_Power, Landmark,Landmark_SE,Landmark_Power)</a>
<a class="sourceLine" id="cb18-18" title="18"><span class="kw">colnames</span>(collated) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Analytic&quot;</span>,<span class="st">&quot;Simulated&quot;</span>)</a>
<a class="sourceLine" id="cb18-19" title="19"></a>
<a class="sourceLine" id="cb18-20" title="20"><span class="co"># Display comparison table</span></a>
<a class="sourceLine" id="cb18-21" title="21">collated</a>
<a class="sourceLine" id="cb18-22" title="22"><span class="co">#&gt;                 Analytic Simulated</span></a>
<a class="sourceLine" id="cb18-23" title="23"><span class="co">#&gt; Events_Active   77.37700  77.54500</span></a>
<a class="sourceLine" id="cb18-24" title="24"><span class="co">#&gt; Events_Control 111.70200 111.66300</span></a>
<a class="sourceLine" id="cb18-25" title="25"><span class="co">#&gt; Events_Total   189.07900 189.20800</span></a>
<a class="sourceLine" id="cb18-26" title="26"><span class="co">#&gt; HR               0.62010   0.62060</span></a>
<a class="sourceLine" id="cb18-27" title="27"><span class="co">#&gt; LogHR           -0.47790  -0.47710</span></a>
<a class="sourceLine" id="cb18-28" title="28"><span class="co">#&gt; LogHR_SE         0.14632   0.14854</span></a>
<a class="sourceLine" id="cb18-29" title="29"><span class="co">#&gt; LR_Power         0.90760   0.90760</span></a>
<a class="sourceLine" id="cb18-30" title="30"><span class="co">#&gt; RMST             3.36750   3.31760</span></a>
<a class="sourceLine" id="cb18-31" title="31"><span class="co">#&gt; RMST_SE          1.38750   1.38310</span></a>
<a class="sourceLine" id="cb18-32" title="32"><span class="co">#&gt; RMST_Power       0.67980   0.66900</span></a>
<a class="sourceLine" id="cb18-33" title="33"><span class="co">#&gt; Landmark         0.16920   0.16840</span></a>
<a class="sourceLine" id="cb18-34" title="34"><span class="co">#&gt; Landmark_SE      0.05020   0.05010</span></a>
<a class="sourceLine" id="cb18-35" title="35"><span class="co">#&gt; Landmark_Power   0.92030   0.91900</span></a></code></pre></div>
<p>As expected, all properties align closely. For testing whether the two values differ by more than would be expected by random, Monte Carlo errors should be calculated for each simulated quantity; in general this is also good practice for analysis and reporting of simulation results.</p>
</div>
</div>
<div id="references" class="section level2">
<h2>5 References</h2>
<p>1 Bell, J. (2019) Power Calculations for Time-to-Event Trials Using Predicted Event Proportions. Manuscript submitted for publication.</p>
<p>2 Pike, M.C. (1972). Contribution to the Discussion on the Paper “Asymptotically efficient rank invariant test procedures” by R. Peto and J. Peto. Journal of the Royal Statistical Society Series A; 135(2): 201-203.</p>
<p>3 Schoenfeld, D. (1981) The asymptotic properties of nonparametric tests for comparing survival distributions. Biometrika; 68: 316-319.</p>
<p>4 Schoenfeld, D.A. (1983) Sample-size formula for the proportional-hazards regression model. Biometrics; 39(2): 499-503.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
